{% extends 'base.html' %}
{% block title %}page3{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{url_for('static',filename="css/page3.css")}}">
{% endblock %}
{% block content %}
<h3>Education Qualifications</h3>
<div id="contentContainer">
    <form id="myForm" action="{{url_for('app_form.page3')}}" method="POST">
        <table border="1">
            <thead>
                <tr>
                    <th>Level</th>
                    <th>Course <span class="required">*</span></th>
                    <th>Board/University/Institution <span class="required">*</span></th>
                    <th>College Name, City, State <span class="required">*</span></th>
                    <th colspan="2">Year <span class="required">*</span></th>
                    <th>Overall Percentage/Grade <span class="required">*</span></th>
                </tr>
                <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>From <span class="required">*</span></th>
                    <th>To <span class="required">*</span></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>10<sup>th</sup> Standard <span class="required">*</span> </td>
                    <td><input type="text" name="course_10"  required></td>
                    <td><input type="text" name="board_university_10" required></td>
                    <td><input type="text" name="college_name_10"  required></td>
                    <td><input type="text" name="year_from_10" pattern="\d{4}" title="Enter a valid 4-digit year" size="4"  required></td>
                    <td><input type="text" name="year_to_10" pattern="\d{4}" title="Enter a valid 4-digit year" size="4"  required></td>
                    <td><input type="text" name="grade_10" required></td>
                </tr>
                <tr>
                    <td>12<sup>th</sup> Standard <span class="required">*</span></td>
                    <td><input type="text" name="course_12" required></td>
                    <td><input type="text" name="board_university_12"  required></td>
                    <td><input type="text" name="college_name_12"  required></td>
                    <td><input type="text" name="year_from_12" pattern="\d{4}" title="Enter a valid 4-digit year" size="4"  required></td>
                    <td><input type="text" name="year_to_12" pattern="\d{4}" title="Enter a valid 4-digit year" size="4"  required></td>
                    <td><input type="text" name="grade_12" required></td>
                </tr>
                <tr>
                    <td>Graduation <span class="required">*</span></td>
                    <td><input type="text" name="course_ug"  required></td>
                    <td><input type="text" name="board_university_ug"  required></td>
                    <td><input type="text" name="college_name_ug"  required></td>
                    <td><input type="text" name="year_from_ug" pattern="\d{4}" title="Enter a valid 4-digit year" size="4"  required></td>
                    <td><input type="text" name="year_to_ug" pattern="\d{4}" title="Enter a valid 4-digit year" size="4"  required></td>
                    <td><input type="text" name="grade_ug"  required></td>
                </tr>
                <tr>
                    <td>Post-Graduation</td>
                    <td><input type="text" name="course_pg"></td>
                    <td><input type="text" name="board_university_pg"></td>
                    <td><input type="text" name="college_name_pg"></td>
                    <td><input type="text" name="year_from_pg" pattern="\d{4}" title="Enter a valid 4-digit year" size="4" ></td>
                    <td><input type="text" name="year_to_pg" pattern="\d{4}" title="Enter a valid 4-digit year" size="4" ></td>
                    <td><input type="text" name="grade_pg"></td>
                </tr>
                <tr>
                    <td>Others</td>
                    <td><input type="text" name="course_ot"></td> <!-- Optional -->
                    <td><input type="text" name="board_university_ot"></td> <!-- Optional -->
                    <td><input type="text" name="college_name_ot"></td> <!-- Optional -->
                    <td><input type="text" name="year_from_ot" pattern="\d{4}" title="Enter a valid 4-digit year" size="4"></td> <!-- Optional -->
                    <td><input type="text" name="year_to_ot" pattern="\d{4}" title="Enter a valid 4-digit year" size="4"></td> <!-- Optional -->
                    <td><input type="text" name="grade_ot"></td> <!-- Optional -->
                </tr>
            </tbody>
        </table>
        <br>
        
        <!-- New Fields -->
        <!-- Work Experience Section -->
<div class="section">
    <h3>Work Experience <span class="required">*</span></h3>
    <div class="inline-options">
        <label for="work_experience_yes">
            <input type="radio" id="work_experience_yes" name="work_experience" value="Yes" required>
            Yes
        </label>
        <label for="work_experience_no">
            <input type="radio" id="work_experience_no" name="work_experience" value="No" required>
            No
        </label>
    </div>
    <div id="work_experience_details" style="display:none;">
        <label for="total_years">Total years of work experience:</label> <span class="required">*</span>
        <input type="text" id="total_years" name="total_years"  required>
        <br>
        <label for="work_from">From:</label> <span class="required">*</span>
        <input type="text" id="work_from" name="work_from"  required>
        <label for="work_to">To:</label> <span class="required">*</span>
        <input type="text" id="work_to" name="work_to" class="required-input" required>
        <br>
        <label for="organization">Organization's Name:</label> <span class="required">*</span>
        <input type="text" id="organization" name="organization" class="required-input" required>
        <br>
        <label for="awards">Awards and Honors received:</label>
        <textarea id="awards" name="awards"></textarea>
        <br>
        <label for="interests">Interests and Hobbies:</label>
        <textarea id="interests" name="interests"></textarea>
    </div>
</div>

<!-- Finance Details Section -->
    <div class="section">
        <h3>Finance Details</h3>
        <label for="family_income">Family's consolidated annual income (p.a.):</label> <span class="required">*</span>
        <select id="family_income" name="family_income" required>
            <option value="<1,00,000">Less than 1,00,000</option>
            <option value="1,00,000-3,00,000">1,00,000 - 3,00,000</option>
            <option value="3,00,000-7,00,000">3,00,000 - 7,00,000</option>
            <option value="7,00,000-10,00,000">7,00,000 - 10,00,000</option>
            <option value=">10,00,000">More than 10,00,000</option>
        </select>
        <br>
        <label for="finance_source">How would you finance studies at Nagarjuna Degree College? <span class="required">*</span></label>
        <div class="inline-options">
            <label for="finance_family">
                <input type="checkbox" id="finance_family" name="finance_source" value="Family">
                Family
            </label>
            <label for="finance_employer">
                <input type="checkbox" id="finance_employer" name="finance_source" value="Employer">
                Employer
            </label>
            <label for="finance_loan">
                <input type="checkbox" id="finance_loan" name="finance_source" value="Loan">
                Loan
            </label>
            <label for="finance_other">
                <input type="checkbox" id="finance_other" name="finance_source" value="Other">
                Other
            </label>
        </div>
    </div>

    <div class="section">
        <h3>Entrance Test Details</h3>
        <label for="test_name">Please fill in the details if you have appeared for any of the following: <span class="required">*</span></label>
        <div class="inline-options">
            <label for="pgcet">
                <input type="checkbox" id="pgcet" name="entrance_test" value="PGCET">
                PGCET
            </label>
            <label for="mat">
                <input type="checkbox" id="mat" name="entrance_test" value="MAT">
                MAT
            </label>
            <label for="cat">
                <input type="checkbox" id="cat" name="entrance_test" value="CAT">
                CAT
            </label>
            <label for="xat">
                <input type="checkbox" id="xat" name="entrance_test" value="XAT">
                XAT
            </label>
            <label for="gmat">
                <input type="checkbox" id="gmat" name="entrance_test" value="GMAT">
                GMAT
            </label>
            <label for="cmat">
                <input type="checkbox" id="cmat" name="entrance_test" value="CMAT">
                CMAT
            </label>
            <label for="other_tests">
                <input type="checkbox" id="other_tests" name="entrance_test" value="Other">
                Other (Please Specify)
            </label>
            <input type="text" id="other_tests_specify" name="other_tests_specify" class="specify-box">
        </div>
        <br>
        <!-- Container where fields will be dynamically added -->
        <div id="exam_details_container"></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const exams = ['pgcet', 'mat', 'cat', 'xat', 'gmat', 'cmat', 'other_tests'];
            const container = document.getElementById('exam_details_container');
        
            exams.forEach(exam => {
                document.getElementById(exam).addEventListener('change', function () {
                    if (this.checked) {
                        addExamDetails(this.id, this.value);
                    } else {
                        removeExamDetails(this.id);
                    }
                });
            });
        
            function addExamDetails(examId, examName) {
                const examDiv = document.createElement('div');
                examDiv.setAttribute('id', examId + '_details');
                examDiv.innerHTML = `
                    <h4>${examName} Exam Details:</h4>
                    <label for="${examId}_score">Your Score Percentage/Percentile: <span class="required">*</span></label>
                    <input type="text" id="${examId}_score" name="${examId}_score"  required>
                    <br>
                    <label for="${examId}_registration_no">Registration No: <span class="required">*</span></label>
                    <input type="text" id="${examId}_registration_no" name="${examId}_registration_no"  required>
                    <br>
                    <label for="${examId}_exam_date">Date of Examination Taken: <span class="required">*</span></label>
                    <input type="date" id="${examId}_exam_date" name="${examId}_exam_date"  required>
                    <br>
                `;
                container.appendChild(examDiv);
            }
        
            function removeExamDetails(examId) {
                const examDiv = document.getElementById(examId + '_details');
                if (examDiv) {
                    container.removeChild(examDiv);
                }
            }
        });
    </script>
        
    
        <!-- <label for="test_score">Your Score Percentage/Percentile:</label> <span class="required">*</span>
        <input type="text" id="test_score" name="test_score"  required>
        <br>
        <label for="registration_no">Registration No:</label> <span class="required">*</span>
        <input type="text" id="registration_no" name="registration_no"  required>
        <br>
        <label for="exam_date">Date of Examination Taken:</label> <span class="required">*</span>
        <input type="date" id="exam_date" name="exam_date"  required>
        <br>
        <label for="no_exams">I have not appeared for any of the above mentioned examinations:</label>
        <input type="checkbox" id="no_exams" name="no_exams"> -->
        <div class="section">
            <button type="submit" id="submitButton" onclick="showConfirmationPopup(event)">Save and Proceed</button>
        </div>
    </form>
</div>

<!-- Confirmation Popup -->
<div id="confirmationPopup" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border:1px solid #ccc;">
    <p>Once clicked on save, you won't be able to modify the details. Are you sure?</p>
    <button onclick="closePopup()">Back</button>
    <button id="saveButton" onclick="saveAndProceed()">Save</button>
</div>
<div id="overlay" class="overlay" style="display:none;"></div>

<script>
// Show confirmation popup
function showConfirmationPopup(event) {
    event.preventDefault(); // Prevent immediate form submission
    if (validateForm()) { // Validate form before showing popup
        document.getElementById('confirmationPopup').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('contentContainer').classList.add('blur');
    }
}

// Close the confirmation popup
function closePopup() {
    document.getElementById('confirmationPopup').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('contentContainer').classList.remove('blur');
}

// Validate form and scroll to first invalid field
function validateForm() {
    let isValid = true;
    const requiredFields = document.querySelectorAll('input[required], select[required], textarea[required]');
    let firstInvalidField = null;

    requiredFields.forEach(field => {
        field.style.borderColor = ''; // Reset previous validation

        if (!field.checkValidity()) {
            field.style.borderColor = 'red'; // Highlight invalid field
            isValid = false;
            if (!firstInvalidField) {
                firstInvalidField = field;
            }
        }
    });

    if (firstInvalidField) {
        firstInvalidField.focus();
        firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    return isValid;
}

// Proceed with form submission
function saveAndProceed() {
    document.getElementById('confirmationPopup').style.display = 'none'; // Close popup
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('contentContainer').classList.remove('blur');
    document.getElementById('myForm').submit(); // Submit the form
}

// Toggle work experience details visibility
document.querySelectorAll('input[name="work_experience"]').forEach(el => {
    el.addEventListener('change', function () {
        const workDetails = document.getElementById('work_experience_details');
        const totalYears = document.getElementById('total_years');
        const workFrom = document.getElementById('work_from');
        const workTo = document.getElementById('work_to');
        const organization = document.getElementById('organization');

        if (this.value === 'Yes') {
            workDetails.style.display = 'block';

            // Make fields required
            totalYears.setAttribute('required', 'required');
            workFrom.setAttribute('required', 'required');
            workTo.setAttribute('required', 'required');
            organization.setAttribute('required', 'required');
        } else {
            workDetails.style.display = 'none';

            // Remove required attributes
            totalYears.removeAttribute('required');
            workFrom.removeAttribute('required');
            workTo.removeAttribute('required');
            organization.removeAttribute('required');
        }
    });
});
</script>
{% endblock %}
